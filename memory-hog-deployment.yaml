apiVersion: apps/v1
kind: Deployment
metadata:
  name: memory-hog
  labels:
    app: memory-hog
spec:
  replicas: 1
  selector:
    matchLabels:
      app: memory-hog
  template:
    metadata:
      labels:
        app: memory-hog
    spec:
      containers:
      - name: memory-hog-container
        image: python:3.9-slim # A lightweight Python image
        command: ["python", "-c"]
        args:
          - |
            import time; import os;
            size_mb = int(os.getenv('MEMORY_TO_CONSUME_MB', '100'));
            print(f"Attempting to consume {size_mb} MB of memory...");
            # Create a list of strings, each 1MB in size, to consume memory
            memory_hog = [' ' * (1024 * 1024) for _ in range(size_mb)];
            print(f"Successfully consumed {size_mb} MB. Holding memory...");
            while True: time.sleep(1); # Keep the process alive
        env:
        - name: MEMORY_TO_CONSUME_MB
          value: "100" # This container will try to consume 100MB
        resources:
          requests:
            memory: "50Mi" # Request 50MiB
            cpu: "50m"
          limits:
            memory: "70Mi" # Limit to 70MiB (less than 100MB it tries to consume)
            cpu: "100m"
